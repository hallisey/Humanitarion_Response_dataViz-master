<!DOCTYPE html>
<html>
<head>
<title>United Nations Office for the Coordination for Humanitarian Affiars (OCHA) Assessment Registry</title>


	<link rel="stylesheet" href="http://libs.cartocdn.com/cartodb.js/v3/themes/css/cartodb.css" />
	<!--[if lte IE 8]>
    	<link rel="stylesheet" href="http://libs.cartocdn.com/cartodb.js/v3/themes/css/cartodb.ie.css" />
	<![endif]-->
	<script src="http://libs.cartocdn.com/cartodb.js/v3/cartodb.js"></script>
    	<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
	<style>
    	html, body {height: 100%; margin: 0; padding: 0; width: 100%;}
      	#map {height:100%; width: 100%;}
      	#filters {width:300px; position:absolute; right:0; top:0; height:100%; overflow:scroll; z-index: 1; background:rgba(255,255,255,.8); box-sizing:border-box; padding:45px 25px 25px 25px; font-family:Arial, Helvetica, sans-serif;}
      	#filters h3 {margin:20px 0 5px 0; font-size:12px; line-height: 19px; text-transform:uppercase; color:rgb(200,200,200);}
      	#filters select, #filters input {width:100%; font-size:14px; line-height:25px; vertical-align: middle; height:30px; box-shadow:none; border:0; color:rgb(50,50,50); border-radius: 4px; width:255px; border:solid 1px rgba(0,0,0,.1);}
      	#filters select:hover {box-shadow:0px 0px 4px 2px rgba(0, 0, 0, 0.2);}
      	#filters select:focus {box-shadow:0px 0px 4px 2px rgba(0, 0, 0, 0.6);}
      	#filters select option {margin:5px 0; font-size:10px;}
      	div.cartodb-searchbox {width:255px; box-shadow: none;}
      	div.cartodb-searchbox input.text {width:203px;}
      	div.cartodb-popup-header {background-color:red;}
      	div.cartodb-popup-header h4 {color:#FFFFFF;}
	</style>
	
	<script type="infowindow/html" id="infowindow_template">
	  <div class="cartodb-popup header orange v2">
		  <a href="#close" class="cartodb-popup-close-button close">x</a>
		  <div class="cartodb-popup-header">
		    <h4>country</h4>
		    <h1>{{data.country}}</h1>
		    <span class="separator"></span>
		  </div>
		  <div class="cartodb-popup-content-wrapper">
		    <div class="cartodb-popup-content">
		      <h4>assessment_url</h4>
		      <p>{{data.assessment_url}}</p>
		      <h4>cluster_label</h4>
		      <p>{{cluster_label}}</p>
		      <h4>data_upload_filename</h4>
		      <p>{{data_upload_filename}}</p>
		      <h4>data_upload_filesize</h4>
		      <p>{{data_upload_filesize}}</p>
		      <h4>data_upload_id</h4>
		      <p>{{data_upload_id}}</p>
		      <h4>data_upload_url</h4>
		      <p>{{data_upload_url}}</p>
		      <h4>date_created</h4>
		      <p>{{date_created}}</p>
		      <h4>date_end</h4>
		      <p>{{date_end}}</p>
		      <h4>date_start</h4>
		      <p>{{date_start}}</p>
		      <h4>date_timezone</h4>
		      <p>{{date_timezone}}</p>
		      <h4>disasters_label</h4>
		      <p>{{disasters_label}}</p>
		      <h4>frequency</h4>
		      <p>{{frequency}}</p>
		      <h4>geo_admin_level</h4>
		      <p>{{geo_admin_level}}</p>
		      <h4>geo_iso_code</h4>
		      <p>{{geo_iso_code}}</p>
		      <h4>geo_pcode</h4>
		      <p>{{geo_pcode}}</p>
		      <h4>geoid</h4>
		      <p>{{geoid}}</p>
		      <h4>id</h4>
		      <p>{{id}}</p>
		      <h4>key_findings</h4>
		      <p>{{key_findings}}</p>
		      <h4>label</h4>
		      <p>{{label}}</p>
		      <h4>last_modified</h4>
		      <p>{{last_modified}}</p>
		      <h4>location_id</h4>
		      <p>{{location_id}}</p>
		      <h4>location_label</h4>
		      <p>{{location_label}}</p>
		      <h4>methodology</h4>
		      <p>{{methodology}}</p>
		      <h4>operation_label</h4>
		      <p>{{operation_label}}</p>
		      <h4>operation_status</h4>
		      <p>{{operation_status}}</p>
		      <h4>operation_url</h4>
		      <p>{{operation_url}}</p>
		      <h4>org_label</h4>
		      <p>{{org_label}}</p>
		      <h4>other_location</h4>
		      <p>{{other_location}}</p>
		      <h4>questionnaire_filename</h4>
		      <p>{{questionnaire_filename}}</p>
		      <h4>questionnaire_filesize</h4>
		      <p>{{questionnaire_filesize}}</p>
		      <h4>questionnaire_id</h4>
		      <p>{{questionnaire_id}}</p>
		      <h4>questionnaire_url</h4>
		      <p>{{questionnaire_url}}</p>
		      <h4>report_filename</h4>
		      <p>{{report_filename}}</p>
		      <h4>report_filesize</h4>
		      <p>{{report_filesize}}</p>
		      <h4>report_id</h4>
		      <p>{{report_id}}</p>
		      <h4>report_url</h4>
		      <p>{{report_url}}</p>
		      <h4>status</h4>
		      <p>{{status}}</p>
		      <h4>subject</h4>
		      <p>{{subject}}</p>
		      <h4>theme_label</h4>
		      <p>{{theme_label}}</p>
		    </div>
		  </div>
		  <div class="cartodb-popup-tip-container"></div>
	  </div>
	</script>
	
	<script>
    	$(document).ready(function () {
        	var subLayer;
		cartodb.createVis('map', 'https://troy.cartodb.com/api/v2/viz/00b0a356-1bfd-11e5-aa2e-0e853d047bba/viz.json', {
			cartodb_logo:false,
			search:true,
			type:cartodb,
			legends:true,
		})
			 
             	.done(function (vis, layers) {
            	subLayer = layers[1].getSubLayer(0);
            	subLayer.setInteraction(true);
            	subLayer.setInteractivity('country, assessment_url, cartodb_id, label');
            	vis.addInfowindow(map, subLayer, ['country'], {
        			infowindowTemplate: $('#infowindow_template').html()
        		});
            	subLayer.on('featureClick', function(e, latlng, pos, data) {
			console.log(data);            	
		});
		subLayer.on('featureOver', function(e, latlng, pos, data) {
             		$('#map').css('cursor','pointer');
		});
             	})
             
             .error(function(e) {
        		console.log(e);
    		 });
             
			 var selectFrom = "SELECT * FROM humanitarian_response WHERE ";
             $("#countrynames").change(function () {
             	var country_name = "";
             	$("#countrynames option:selected").each(function() {
             		country_name += $(this).val();
             	});
             	subLayer.setSQL(selectFrom + "country = \'" + country_name + "\'");
             	$('#clusternames, #datechange').val('clear');
             });
             
             $("#clusternames").change(function () {
             	var cluster_name = "";
             	$("#clusternames option:selected").each(function() {
             		cluster_name += $(this).val();
             	});
             	subLayer.setSQL(selectFrom + "cluster_label LIKE \'%" + cluster_name + "%\'");
             	$('#countrynames, #datechange').val('clear');
             });
             
             $("#datechange").change(function () {
             	var today = new Date();
	        	var yesterday = today.toISOString(today.setDate(today.getDate() - 1));
	        	var oneweek = today.toISOString(today.setDate(today.getDate() - 7));
	        	var twoweeks = today.toISOString(today.setDate(today.getDate() - 14));
	        	var thirtydays = today.toISOString(today.setDate(today.getDate() - 30));
	        	var nintydays = today.toISOString(today.setDate(today.getDate() - 90));
             	$("#datechange option:selected").each(function() {
             		the_dates = eval($(this).val());
             	});
             	subLayer.setSQL(selectFrom + "date_start > \'" + the_dates + "\'");
             	$('#countrynames, #clusternames').val('clear');
             });
             
             //$.getJSON('https://troy.cartodb.com/api/v2/sql/?q=SELECT DISTINCT org_label FROM humanitarian_response', function(data) {
			 	//$.each(data.rows, function(key, val) {
					//alert(element.org_label);
				//});
			 //});
			 
    	});
	</script>

    </head>
    <body>
        <div id="filters">
        	<h3>Filter by Country</h3>
    		<select id="countrynames">
    			<option selected disabled value='clear'>Select a Country</option>
    			<option value="Afghanistan">Afghanistan</option>
    			<option value="Burkina Faso">Burkina Faso</option>
    			<option value="Cameroon">Cameroon</option>
    			<option value="Central African Republic">Central African Republic</option>
    			<option value="Chad">Chad</option>
    			<option value="Colombia">Colombia</option>
    			<option value="Congo, The Democratic Republic of the">Congo, The Democratic Republic of the</option>
    			<option value="Egypt">Egypt</option>
    			<option value="Ethiopia">Ethiopia</option>
    			<option value="Haiti">Haiti</option>
    			<option value="Iraq">Iraq</option>
    			<option value="Jordan">Jordan</option>
    			<option value="Kenya">Kenya</option>
    			<option value="Lebanon">Lebanon</option>	
    			<option value="Liberia">Liberia</option>	
    			<option value="Mali">Mali</option>	
    			<option value="Mauritania">Mauritania	</option>
    			<option value="Nepal">Nepal</option>	
    			<option value="Nigeria">Nigeria</option>	
    			<option value="occupied Palestinian territory">occupied Palestinian territory</option>	
    			<option value="Pakistan">Pakistan</option>	
    			<option value="Philippines">Philippines</option>	
    			<option value="Senegal">Senegal</option>	
    			<option value="Sierra Leone">Sierra Leone</option>	
    			<option value="Solomon Islands">Solomon Islands</option>	
    			<option value="Somalia">Somalia</option>	
    			<option value="South Sudan">South Sudan</option>	
    			<option value="Sudan">Sudan</option>	
    			<option value="Syrian Arab Republic">Syrian Arab Republic</option>
    			<option value="Tonga">Tonga</option>
    			<option value="Turkey">Turkey</option>	
    			<option value="Uganda">Uganda</option>	
    			<option value="Ukraine">Ukraine</option>
    			<option value="Vanuatu">Vanuatu</option>
    			<option value="Yemen">Yemen</option>	
    			<option value="Zimbabwe">Zimbabwe</option>
    		</select>
        	<h3>Filter by Global Cluster</h3>
    		<select id="clusternames">
    			<option selected disabled value='clear'>Select a Global Cluster</option>
    			<option value="Camp Coordination / Management">Camp Coordination / Management</option>
    			<option value="Child Protection">Child Protection</option>
    			<option value="Early Recovery">Early Recovery</option>
    			<option value="Education">Education</option>
    			<option value="Emergency Shelter and NFI">Emergency Shelter and NFI</option>
    			<option value="Emergency Telecommunications">Emergency Telecommunications</option>
    			<option value="Food Security">Food Security</option>
    			<option value="Gender Based Violence">Gender Based Violence</option>
    			<option value="Health">Health</option>
    			<option value="Housing">Housing</option>
    			<option value="Land and Property">Land and Property</option>
    			<option value="Logistics">Logistics</option>
    			<option value="Mine Action">Mine Action</option>
    			<option value="Nutrition">Nutrition</option>
    			<option value="Protection">Protection</option>
    			<option value="Water Sanitation Hygiene">Water Sanitation Hygiene (WASH)</option>
    		</select>
    		<h3>Filter by Date</h3>
    		<select id="datechange">
    			<option selected disabled value='clear'>Select a Time Period</option>
    			<option value="yesterday">Yesterday</option>
    			<option value="oneweek">Past Week</option>
    			<option value="twoweeks">Past Two Weeks</option>
    			<option value="thirtydays">Past 30 Days</option>
    			<option value="nintydays">Past 90 Days</option>
    		</select>
    		<h3>Filter by Organization Name</h3>
    		<input id="field" placeholder="Filter by Organization Name" />
        </div>
        <div id="map"></div>
    </body>
</html>
